// Generated by IcedCoffeeScript 1.2.0i
((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x={}.hasOwnProperty,y=function(a,b){function d(){this.constructor=a}for(var c in b)x.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=function(a){console.log(typeof a=="object"?JSON.stringify(a):a)},g=function(a,c,d,e){return"rgba("+Math.floor(b(a,0,255))+","+Math.floor(b(c,0,255))+","+Math.floor(b(d,0,255))+","+(e!=null?e:"255")+")"},h=function(a){return a*a},f=function(a,b,c){return a+(b-a)*c},b=function(a,b,c){return a<b?b:a>c?c:a},n=function(a,b,c){return a<b?a+(c-b):a>c?a-(c-b):a},l=function(a){return Math.floor(Math.random()*a)},m=function(a,b){return Math.floor(Math.random()*(b-a)+a)},j=function(a){return Math.random()*a},k=function(a,b){return Math.random()*(b-a)+a},i=function(a,b,c){return a||(a=0),b||(b=255),g(m(a,b),m(a,b),m(a,b),c)},window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){return window.setTimeout(a,1e3/60)}),this.Vec2=function(){function a(a,b){this.x=a||0,this.y=b||0}return a.name="Vec2",a.FromAngLen=function(b,c){return new a(c*Math.cos(b),c*Math.sin(b))},a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.sub=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.len2=function(){return this.x*this.x+this.y*this.y},a.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.ang=function(){return Math.atan(this.y,this.x)},a.prototype.norm=function(){var b;return b=this.len(),b>1e-4?new a(this.x/b,this.y/b):new a(1,0)},a.prototype.scale=function(b){return new a(this.x*b,this.y*b)},a.prototype.clamp=function(b){var c,d;return d=this.len(),d<b?this.clone():(c=b/d,new a(this.x*c,this.y*c))},a.prototype.perp=function(){return new a(-this.y,this.x)},a.prototype.rot=function(b){var c,d;return c=Math.cos(b),d=Math.sin(b),new a(this.x*c-this.y*d,this.y*c+this.x*d)},a}(),this.Mat2=function(){function a(a){this.m=a||[1,0,0,1,0,0]}return a.name="Mat2",a.prototype.mult=function(b){var c,d,e,f,g,h;return c=this.m[0]*b.m[0]+this.m[2]*b.m[1],d=this.m[1]*b.m[0]+this.m[3]*b.m[1],e=this.m[0]*b.m[2]+this.m[2]*b.m[3],f=this.m[1]*b.m[2]+this.m[3]*b.m[3],g=this.m[0]*b.m[4]+this.m[2]*b.m[5]+this.m[4],h=this.m[1]*b.m[4]+this.m[3]*b.m[5]+this.m[5],new a([c,d,e,f,g,h])},a.prototype.det=function(){return 1/(this.m[0]*this.m[3]-this.m[1]*this.m[2])},a.prototype.invert=function(){var b,c,d,e,f,g,h;return b=this.det(),c=this.m[3]*b,d=-this.m[1]*b,e=-this.m[2]*b,f=this.m[0]*b,g=b*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),h=b*(this.m[1]*this.m[4]-this.m[0]*this.m[5]),new a([c,d,e,f,g,h])},a.prototype.rotate=function(b){var c,d,e,f,g,h;return c=Math.cos(b),h=Math.sin(b),d=this.m[0]*c+this.m[2]*h,e=this.m[1]*c+this.m[3]*h,f=this.m[0]*-h+this.m[2]*c,g=this.m[1]*-h+this.m[3]*c,new a([d,e,f,g,this.m[4],this.m[5]])},a.prototype.translate=function(b,c){var d,e;return d=this.m[4]+this.m[0]*b+this.m[2]*c,e=this.m[5]+this.m[1]*b+this.m[3]*c,new a([this.m[0],this.m[1],this.m[2],this.m[3],d,e])},a.prototype.scale=function(b,c){return new a([this.m[0]*b,this.m[1]*b,this.m[2]*c,this.m[3]*c,this.m[4],this.m[5]])},a.prototype.transform=function(a,b){return b!=null?new Vec2(a*this.m[0]+b*this.m[2]+this.m[4]):new Vec2(a.x*this.m[0]+a.y*this.m[2]+this.m[4])},a.prototype.apply=function(a){a.setTransform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5]),a.xform=this},a}(),c=function(){function a(){this.life=0,this.alive=!0,this.idx=null,this.layer=0,this.container=null,this.xform=new Mat2;return}return a.name="Go",a.prototype.tick=function(a){this.life+=a},a.prototype.born=function(){this.container.addToLayer(this.layer)},a.prototype.die=function(){this.container.removeFromLayer(this.layer)},a.prototype.render=function(){},a.prototype.changeLayer=function(a){a!==this.layer&&(this.container.addToLayer(a),this.container.removeFromLayer(this.layer),this.layer=layer)},a.prototype.kill=function(){this.container.killgo(this)},a}(),d=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.gos=[],this.newgos=[],this.deadgos=!1,this.layers={}}return y(b,a),b.name="GoContainer",b.prototype.creatego=function(a){this.newgos.push(a),a.container=this},b.prototype.killgo=function(a){a.alive&&(a.alive=!1,this.deadgos=!0)},b.prototype.removeFromLayer=function(a){this.layers[a]--,this.layers[a]||delete this.layers[a]},b.prototype.addToLayer=function(a){this.layers[a]=(this.layers[a]||0)+1},b.prototype.tick=function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;b.__super__.tick.apply(this,arguments),r=this.gos;for(e=j=0,n=r.length;j<n;e=++j)d=r[e],d.tick(a);while(this.newgos.length>0){g=this.newgos,this.newgos=[],h=this.gos.length;for(e=k=0,o=g.length;k<o;e=++k)d=g[e],d.idx=this.gos.length,this.gos.push(d),d.born(),d.tick(a),this.addToLayer(d.layer)}while(this.deadgos){this.deadgos=!1,c=[],s=this.gos;for(e=l=0,p=s.length;l<p;e=++l)d=s[e],d.alive?d.idx-=c.length:(d.die(),this.removeFromLayer(d.layer),c.push(e));for(e=m=0,q=c.length;m<q;e=++m)f=c[e],i=f-e,this.gos.splice(i,1)}},b.prototype.die=function(){var a,c,d,e,f;b.__super__.die.apply(this,arguments),e=this.gos,f=[];for(c=0,d=e.length;c<d;c++)a=e[c],f.push(a.die());return f},b.prototype.render=function(a){var b,c,d,e,f,g,h,i,j,k;this.xform!=null&&(e=a.xform,(e!=null?e.mult(this.xform):this.xform).apply(a)),d=function(){var a,b;a=this.layers,b=[];for(c in a)f=a[c],b.push(parseInt(c));return b}.call(this),d.sort();for(g=0,i=d.length;g<i;g++){c=d[g],k=this.gos;for(h=0,j=k.length;h<j;h++)b=k[h],b.layer===c&&b.render(a)}this.xform!=null&&(e!=null?e.apply(a):(delete a.xform,a.setTransform(1,0,0,1,0,0)))},b}(c),r=0,t=1,a=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.reset()}return y(b,a),b.name="Blob",b.prototype.reset=function(){return this.maxlife=k(.1,.8),this.radius=t*k(.01,.1),this.color=i(0,255,.2),this.pos=new Vec2(l(p.width),l(p.height))},b.prototype.tick=function(a){b.__super__.tick.apply(this,arguments),this.radius++;if(this.life>=this.maxlife)return this.kill()},b.prototype.born=function(){return this.layer=r++,b.__super__.born.apply(this,arguments)},b.prototype.die=function(){return b.__super__.die.apply(this,arguments),this.container.creatego(new b)},b.prototype.render=function(a){return a.beginPath(),a.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI*2,!0),a.fillStyle=this.color,a.fill()},b}(c),w=null,p=null,q=null,o=new d,u=function(){p.width=w.width(),p.height=w.height(),t=Math.min(p.width,p.height),o.xform=(new Mat2).translate(p.width/2,p.height/2).scale(.5,.5)},s=0,v=function(){var a,b;b=Date.now(),a=(b-s)*.001,a>0&&(s!==0&&(a>1&&(a=1),o.tick(a),o.xform=o.xform.rotate(a*.8),o.render(q)),s=b),requestAnimationFrame(v)},$(function(){var b,c;e("Starting up"),w=$("#uicontainer"),w.css("background",g(0,0,0)),p=document.createElement("canvas"),$(p).addClass("fullscreen"),w.append(p),q=p.getContext("2d"),$(document).bind("touchmove",function(a){return a.preventDefault()}),$(window).resize(u),$(document).bind("orientationChanged",function(a){return u()}),u();for(b=c=0;c<20;b=++c)o.creatego(new a);v()})})).call(this);